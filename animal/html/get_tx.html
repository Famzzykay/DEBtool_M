
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>get_tx</title><meta name="generator" content="MATLAB 9.10"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-08-27"><meta name="DC.source" content="get_tx.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>get_tx</h1><!--introduction--><p>gets scaled age and length at puberty, weaning, birth for foetal development.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Syntax</a></li><li><a href="#4">Description</a></li><li><a href="#5">Remarks</a></li><li><a href="#6">Examples</a></li></ul></div><h2 id="3">Syntax</h2><p>varargout = <a href="../get_tx.m"><b>get_tx</b></a> (p, f, tel_b, tau)</p><h2 id="4">Description</h2><p>Obtains scaled age and length at puberty, weaning, birth for foetal development. An extra optional parameter, the stress coefficient for foetal development can modify the rate of development from fast    (default, and a large stress coefficient of 1e8) to slow (value 1 gives von Bertalanffy growth of the same rate as post-natal development). Multiply the result with the somatic maintenance rate coefficient to arrive at age at puberty, weaning and birth.</p><p>Input</p><div><ul><li>p: 6 or 7 -vector with parameters: g, k, l_T, v_Hb, v_Hx, v_Hp, s_F</li><li>f: optional (default f = 1)</li></ul></div><pre>    - scalar with scaled functional response for period bi
    - 2-vector with scaled functional responses for periods bx and xi
    - (n,2)-array with scaled times and sfunctional responses in the columns</pre><div><ul><li>tel_b: optional scalar with scaled length at birth</li></ul></div><pre>    or 3-vector with scaled age at birth, reserve density and length at 0</pre><div><ul><li>tau: optional n-vector with scaled times since birth</li></ul></div><p>Output</p><div><ul><li>tvel: optional (n,4)-array with scaled time-since-birth, maturity, reserve density and length</li><li>tau_p: scaled age at puberty \tau_p = a_p k_M</li><li>tau_x: scaled age at puberty \tau_x = a_x k_M</li><li>tau_b: scaled age at birth \tau_b = a_b k_M</li><li>lp: scaled length at puberty</li><li>lx: scaled length at weaning</li><li>lb: scaled length at birth</li><li>info: indicator equals 1 if successful, 0 otherwise</li></ul></div><h2 id="5">Remarks</h2><p>uses integration over scaled age with event detection; this function replaces get_tx_old</p><h2 id="6">Examples</h2><p>See predict_Moschus_berezovskii for a gradual change from f_bx to f_xi; and predict_Moschiola_meminna for an instantaneous change</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% get_tx
% gets scaled age and length at puberty, weaning, birth for foetal development.

%%
function varargout = get_tx(p, f, tel_b, tau)
  % created 2019/02/04 by Bas Kooijman, modified 2023/08/26
  
  %% Syntax
  % varargout = <../get_tx.m *get_tx*> (p, f, tel_b, tau)
  
  %% Description
  % Obtains scaled age and length at puberty, weaning, birth for foetal development. 
  % An extra optional parameter, the stress coefficient for foetal development can modify the rate of development from fast 
  %    (default, and a large stress coefficient of 1e8) to slow (value 1 gives von Bertalanffy growth of the same rate as post-natal development). 
  % Multiply the result with the somatic maintenance rate coefficient to arrive at age at puberty, weaning and birth. 
  %
  % Input
  %
  % * p: 6 or 7 -vector with parameters: g, k, l_T, v_Hb, v_Hx, v_Hp, s_F
  % * f: optional (default f = 1)
  %
  %      - scalar with scaled functional response for period bi
  %      - 2-vector with scaled functional responses for periods bx and xi
  %      - (n,2)-array with scaled times and sfunctional responses in the columns
  %
  % * tel_b: optional scalar with scaled length at birth
  %
  %      or 3-vector with scaled age at birth, reserve density and length at 0
  %
  % * tau: optional n-vector with scaled times since birth
  %
  % Output
  %
  % * tvel: optional (n,4)-array with scaled time-since-birth, maturity, reserve density and length
  % * tau_p: scaled age at puberty \tau_p = a_p k_M
  % * tau_x: scaled age at puberty \tau_x = a_x k_M
  % * tau_b: scaled age at birth \tau_b = a_b k_M
  % * lp: scaled length at puberty
  % * lx: scaled length at weaning
  % * lb: scaled length at birth
  % * info: indicator equals 1 if successful, 0 otherwise

  %% Remarks
  % uses integration over scaled age with event detection; this function replaces get_tx_old 
  
  %% Examples
  % See predict_Moschus_berezovskii for a gradual change from f_bx to f_xi;
  % and predict_Moschiola_meminna for an instantaneous change

  % unpack pars
  g    = p(1); % -, energy investment ratio
  k    = p(2); % -, k_J/ k_M, ratio of maturity and somatic maintenance rate coeff
  l_T  = p(3); % -, scaled heating length
  v_Hb = p(4); % v_H^b = U_H^b g^2 kM^3/ (1 - kap) v^2; U_B^b = M_H^b/ {J_EAm}
  v_Hx = p(5); % v_H^x = U_H^x g^2 kM^3/ (1 - kap) v^2; U_B^x = M_H^x/ {J_EAm}
  v_Hp = p(6); % v_H^p = U_H^p g^2 kM^3/ (1 - kap) v^2; U_B^p = M_H^p/ {J_EAm}
  if length(p) >= 7
    s_F = p(7); % slow development: s_F = 1, for s_F > 1 intermediate between slow and fast
  else
    s_F = 1e10;  % fast development
  end

  % optional input f
  if ~exist('f','var')
    f = 1; 
  end 
  % optional input tau
  if exist('tau','var') 
    info_tau = 1; % time points are specified
  else
    info_tau = 0; tau = 1e20; 
  end
  
  % embryo
  if size(f,1)==1 && size(f,2)==1
    f_0b = f;
  elseif size(f,1)==1 && size(f,2)==2
    f_0b = f(2);
  else
    f_0b = spline1(1e10, f); % ultimate f of mother
  end
  options = odeset('Events',@event_b, 'AbsTol',1e-9, 'RelTol',1e-9); 
  [~, ~, tau_b, vl_b] = ode45(@dget_lb, [0; 1e10], [1e-20; 1e-20], options, f_0b, s_F, g, k, v_Hb);
  l_b = vl_b(1,2);
  
  % optional input tel_b
  if ~exist('tel_b','var') || isempty(tel_b)
    vel_b = [v_Hb;f_0b;l_b]; 
  elseif length(tel_b) == 1
    vel_b = [v_Hb;f_0b;tel_b]; 
  else
    vel_b = [v_Hb;f_0b;tel_b(2);tel_b(3)]; tau_b = tel_b(1); 
  end

  % juvenile & adult
  options = odeset('Events',@event_xp, 'AbsTol',1e-9, 'RelTol',1e-9); 
  [tau, vel, tau_xp, vel_xp] = ode45(@dget_lx, [-1e-10; tau], vel_b, options, info_tau, f, g, k, l_T, v_Hx, v_Hp);
  if isempty(tau_xp) 
    tau_x = []; tau_p = []; l_x = []; l_p = [];
  elseif length(tau_xp) == 1
    tau_x = tau_b + tau_xp(1); tau_p = []; l_x = vel_xp(1,3); l_p = [];
  else
    tau_x = tau_b + tau_xp(1); tau_p = tau_b + tau_xp(2); l_x = vel_xp(1,3); l_p = vel_xp(2,3);
  end
  tvel = [tau, vel]; tvel(1,:) = []; info = 1;

  if ~isreal(tau_b) | ~isreal(tau_x) | ~isreal(tau_p) | tau_b < 0 | tau_x < 0 | tau_p < 0 % tb, tx and tp must be real and positive
    info = 0;
  end

  if info_tau % time points are specified
    varargout = {tvel, tau_p, tau_x, tau_b, l_p, l_x, l_b, info};
  else
    varargout = {tau_p, tau_x, tau_b, l_p, l_x, l_b, info};
  end

end

% subfunctions

function dvl = dget_lb (tau, vl, f, s_F, g, k, v_Hb)
  % tau: scaled time since start development 
  v_H = vl(1); l = vl(2); % f constant; embryo
  
  l_i = s_F * f; % -, scaled ultimate length
  f  = s_F * f;  % -, scaled functional response
  dl = (g/ 3) * (l_i - l)/ (f + g);    % d/d tau l  
  dv_H = 3 * l^2 * dl + l^3 - k * v_H; % d/d tau v_H
  dvl = [dv_H; dl]; % pack to output
end

function dvel = dget_lx (tau, vel, info_tau, tf, g, k, l_T, v_Hx, v_Hp)
  % tau: scaled time since birth 
  v_H = vel(1); e = vel(2); l = vel(3);
  
  if size(tf,1)==1 && size(tf,2)==1 % f constant in period bi
    f = tf(1); e = f; 
  elseif size(tf,1)==1 && size(tf,2)==2 % f constant in periods bx and xi
    if v_H < v_Hx; f = tf(1); else f = tf(2); end; e = f;  
  else % f is varying
    f = spline1(tau,tf);
  end
  
  de = (f - e) * g/ l; % d/d tau e
  rho = g * (e/ l - 1 - l_T/ l)/ (e + g); % -, spec growth rate
  dl = l * rho/ 3; % -, d/d tau l  
  dv_H = e * l^2 * (l + g)/ (e + g) - k * v_H; % -, d/d tau v_H
  dvel = [dv_H; de; dl]; % pack to output
end

function [value,isterminal,direction] = event_xp(tau, vel, info_tau, tf, g, k, l_T, v_Hx, v_Hp)
  % vel: 3-vector with [v_H; e; l]
  value = [v_Hx; v_Hp] - vel(1);
  isterminal = [0; ~info_tau];
  direction  = [0; ]; 
end

function [value,isterminal,direction] = event_b(tau, vl, f, s_F, g, k, v_Hb)
  % vel: 2-vector with [v_H; l]
  value = v_Hb - vl(1);
  isterminal = 1;
  direction  = 0; 
end

##### SOURCE END #####
--></body></html>