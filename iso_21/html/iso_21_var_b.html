
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>iso_21_var_b</title><meta name="generator" content="MATLAB 9.10"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-07-30"><meta name="DC.source" content="iso_21_var_b.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>iso_21_var_b</h1><!--introduction--><p>computes age and length at birth, initial reserve of the iso_21_var model</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Syntax</a></li><li><a href="#4">Description</a></li><li><a href="#5">Remarks</a></li></ul></div><h2 id="3">Syntax</h2><p>[L_b, a_b, M_E10, M_E20, info] = <a href="../iso_21_var_b.m"><b>iso_21_var_b</b></a> (m_E1b, m_E2b, p)</p><h2 id="4">Description</h2><p>computes age and length at birth, intitial reserves of the iso_21 model</p><p>Input:</p><div><ul><li>m_E1b: scalar with reserve density 1 at birth (mol/mol)</li><li>m_E2b: scalar with reserve density 2 at birth (mol/mol)</li><li>p: structure with parameters, see mydata_iso_221_var</li></ul></div><p>Output:</p><div><ul><li>L_b: scalar with length at birth (cm)</li><li>a_b: scalar with age at birth (d)</li><li>M_E10: scalar with initial reserve 1 (mol)</li><li>M_E20: scalar with initial reserve 2 (mol)</li><li>info: indicator for failure (0) or success (1)</li></ul></div><h2 id="5">Remarks</h2><p>requires fniso_21_var_b, diso_21_var_b, sgr_iso_21_var_b (see below)</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2021a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% iso_21_var_b
% computes age and length at birth, initial reserve of the iso_21_var model

%%
function [L_b, a_b, M_E10, M_E20, info] = iso_21_var_b(m_E1b, m_E2b, p)
  % created 2012/03/06 by Bas Kooijman, modified 2023/07/16

  %% Syntax
  % [L_b, a_b, M_E10, M_E20, info] = <../iso_21_var_b.m *iso_21_var_b*> (m_E1b, m_E2b, p)

  %% Description
  % computes age and length at birth, intitial reserves of the iso_21 model
  %
  % Input:
  %
  % * m_E1b: scalar with reserve density 1 at birth (mol/mol)
  % * m_E2b: scalar with reserve density 2 at birth (mol/mol)
  % * p: structure with parameters, see mydata_iso_221_var
  %
  % Output:
  %
  % * L_b: scalar with length at birth (cm)
  % * a_b: scalar with age at birth (d)
  % * M_E10: scalar with initial reserve 1 (mol)
  % * M_E20: scalar with initial reserve 2 (mol)
  % * info: indicator for failure (0) or success (1)
  
  %% Remarks
  % requires fniso_21_var_b, diso_21_var_b, sgr_iso_21_var_b (see below)

  global L_b % only used to check solution in subfunction birth
  
  % guess L_b
  kap_G = 0.8;                       % -, initial guess for growth efficiency
  E_G = p.MV * p.mu_V/ kap_G;        % J/cm^3, [E_G] spec cost for structure
  V_b = p.E_Hb * p.kap/ E_G/ (1 - p.kap); % cm^3, initial guess for length at birth
  L_b = V_b^(1/3);                   % cm. initial guess for length at birth
  
  % solve struc length at birth L_b
  [L_b, fn, info] = fzero(@fniso_21_var_b, L_b, [], m_E1b, m_E2b, p);
  if ~(info == 1)
    fprintf('Warning from iso_21_var_b: no convergence for L_b')
  end

  % get L_b and a_b
  LE12H_b = [L_b; m_E1b; m_E2b; p.E_Hb]; % states at birth, L_b is guessed
  options = odeset('Events',@start, 'RelTol',1e-9, 'AbsTol',1e-9);
  [a, LE12H, a_start, LE12H_start] = ode45(@diso_21_var_b,[0;-1e3], LE12H_b, options, p);
  a_b = -a_start; % d, age at birth
  
  % get initial reserves
  L_0 = LE12H(end,1);          % cm, initial structural length (near 0)      
  M_V0  = p.MV * L_0^3;        % mol, initial structure (near 0)
  M_E10 = M_V0 * LE12H(end,2); % mol, initial reserve 1
  M_E20 = M_V0 * LE12H(end,3); % mol, initial reserve 2
  
  return % comment out if you want to see the results of the check
  % check result by foreward integration
  options = odeset('Events',@birth, 'RelTol',1e-9, 'AbsTol',1e-9);
  [a, LE12H, a_birth, LE12H_birth] = ode45(@diso_21_var_b,[0; 1e3], [L_0; M_E10/ M_V0; M_E20/ M_V0; 0], options, p);
  [a_b    a_birth]
  [L_b    LE12H_birth(1)]
  [m_E1b  LE12H_birth(2)]
  [m_E2b  LE12H_birth(3)]
  [p.E_Hb LE12H_birth(4)]
  
end

function F = fniso_21_var_b(L, m_E1, m_E2, p)
  % for use by fzero in iso_21_var_b: F = 0 if L(0) = 0
  % parameters p are only used to pass to diso_21_var
  
  warning('off','all'); % suppress failure warnings to meet integration tolerances
  
  % back-integrate back in time till E_H(t)=0
  options = odeset('Events',@start, 'RelTol', 1e-9, 'AbsTol', 1e-9);
  LE12H_b = [L; m_E1; m_E2; p.E_Hb]; % states at birth
  try
    [~, LE12H] = ode45(@diso_21_var_b,[0;-1e3], LE12H_b, options, p); 
    F = LE12H(end,1)-1e-3; % cm, norm L(0) = 0
  catch % L (at birth) too low, which leads to failure of the integration near start
    F = 1; % just a value different from zero, so fzero will not select this L
  end
  
  warning('on','all'); % activate all warnings

end

function dLE12H = diso_21_var_b(a, LE12H, p)
% ode's for iso_21_var_b:
%   derivatives of (L, m_E1, m_E2, a) with respect to time during embryo stage, used by iso_21_var_b

% unpack states
  L    = LE12H(1);                                            % cm, structural length
  m_E1 = LE12H(2);                                            % mol/mol, reserve density 1
  m_E2 = LE12H(3);                                            % mol/mol, reserve density 2
  E_H  = LE12H(4);                                            % J, maturity

%growth
[r, j_E1_M, j_E2_M, j_E1C, j_E2C, j_E1P, j_E2P] = ...         % 1/d, spec growth rate, notice k_E = v/L      
    sgr_iso_21_var_b (m_E1, m_E2, p.j_E1M, p.j_E2M, p.mu_E1, p.mu_E2, p.mu_V, p.v/L, p.kap);
dL = r * L/ 3;                                                % cm/d, change in L, ..

% maturation
M_V = p.MV * L^3;                                             % mol, mass of structure
J_E1C = j_E1C * M_V; J_E2C = j_E2C * M_V;                     % mol/d, mobilisation flux
p_C = p.mu_E1 * J_E1C + p.mu_E2 * J_E2C;                      % J/d, total mobilisation
dE_H = (1 - p.kap) * p_C - p.k_J * E_H;                       % J/d, maturation

% reserve dynamics
dm_E1 = p.kap_E1 * j_E1P - m_E1 * p.v/ L;                     % mol/d.mol, change in m_E1
dm_E2 = p.kap_E2 * j_E2P - m_E2 * p.v/ L;                     % mol/d.mol, change in m_E2

dLE12H = [dL; dm_E1; dm_E2; dE_H];                            % pack output
end

function [r, j_E1_S, j_E2_S, j_E1C, j_E2C, j_E1P, j_E2P] = ...
    sgr_iso_21_var_b (m_E1, m_E2, j_E1S, j_E2S, mu_E1, mu_E2, mu_V, k_E, kap)
  % like sgr_iso_21_var, but for embryos, with mode = 1 assumed: reserve 2 fuels all maintenance and growth overheads
  
  r = mu_E1 * kap * m_E1 * k_E/ (mu_V + mu_E1 * kap * m_E1);  % 1/d, specific growth rate if mode = 1
  j_E1C = (k_E - r) * m_E1; j_E2C = (k_E - r) * m_E2; % mol/d.mol mobilisation rates if mode = 1
  j_E2G = kap * j_E2C - j_E2S;   % mol/d.mol growth allocations if mode = 1
  kap_G = mu_V * r/ (mu_E1 * (kap * j_E1C - j_E1S) + mu_E2 * (kap * j_E2C - j_E2S)); % -, growth efficiency
  j_E2_S = min(kap * j_E2C, j_E2S); j_E1_S = min(kap * j_E1C, j_E1S * (1 - j_E2_S/ j_E2S)); % mol/d.mol specific som maint rates
  j_E1P = 0; j_E2P = j_E2G - r * (1/ kap_G - 1) * mu_V/ mu_E2;  % mol/d.mol, specific rejection flux
end
    
% event start development
function [value,isterminal,direction] = start(t, LE12H, p)
  value = LE12H(4) - 1e-3;  % trigger E_H(0)=0
  isterminal = 1;   % terminate after the first event
  direction  = [];  % get all the zeros
end

% event birth
function [value,isterminal,direction] = birth(t, LE12H, p)
  global L_b
  value = LE12H(1) - L_b;  % trigger L(a_b) = L_b
  isterminal = 1;   % terminate after the first event
  direction  = [];  % get all the zeros
end

##### SOURCE END #####
--></body></html>